<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üß† Plagiarism & AI Pattern Detector</title>

  <!-- Google Font 
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
 -->
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Cytoscape.js for visualization -->
  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.8rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #007bff, #6610f2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
    }

    .header p {
      font-size: 1.1rem;
      color: #666;
      max-width: 800px;
      margin: 0 auto;
    }

    /* Navigation Styles */
    .nav-container {
      display: flex;
      justify-content: center;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .nav-tabs {
      display: flex;
      background: white;
      border-radius: 50px;
      padding: 8px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
    }

    .nav-tab {
      flex: 1;
      text-align: center;
      padding: 15px 30px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .nav-tab:hover {
      background-color: #f0f8ff;
    }

    .nav-tab.active {
      background: linear-gradient(90deg, #007bff, #6610f2);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
    }

    /* Container Styles */
    .container {
      display: none;
      width: 90%;
      max-width: 1200px;
      margin: 0 auto 40px;
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.5s ease;
    }

    .container.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .container-title {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: #444;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .container-title i {
      color: #007bff;
    }

    /* Text Area Styles */
    .text-input-container {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .text-input-box {
      flex: 1;
      min-width: 300px;
    }

    .text-input-box h3 {
      margin-bottom: 15px;
      color: #555;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .text-input-box h3 i {
      color: #007bff;
    }

    textarea {
      width: 100%;
      height: 200px;
      padding: 20px;
      border-radius: 12px;
      border: 2px solid #e1e5eb;
      font-size: 16px;
      font-family: 'Poppins', sans-serif;
      resize: vertical;
      transition: all 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
    }

    /* Button Styles */
    .button-container {
      text-align: center;
      margin: 30px 0;
    }

    .action-btn {
      padding: 16px 45px;
      border: none;
      background: linear-gradient(90deg, #007bff, #6610f2);
      color: white;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 123, 255, 0.4);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    /* Result Styles */
    #result {
      margin-top: 30px;
      padding: 25px;
      border-radius: 15px;
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f5ff 100%);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
      border-left: 5px solid #007bff;
    }

    /* Stats Styles */
    #stats {
      margin-top: 30px;
      padding: 25px;
      border-radius: 15px;
      background: #f8f9fa;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .stats-title {
      font-size: 1.4rem;
      margin-bottom: 20px;
      color: #444;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .stat-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      border-top: 4px solid #007bff;
    }

    .stat-title {
      font-size: 1rem;
      color: #666;
      margin-bottom: 10px;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
    }

    /* Visualization Styles */
    #cy {
      width: 100%;
      height: 400px;
      margin-top: 30px;
      border-radius: 15px;
      border: 2px solid #e1e5eb;
      background: #fafafa;
      overflow: hidden;
    }

    .viz-title {
      font-size: 1.4rem;
      margin: 30px 0 15px 0;
      color: #444;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      color: #666;
      font-size: 0.9rem;
    }

    .automaton-explanation {
      background: #f0f8ff;
      padding: 20px;
      border-radius: 12px;
      margin-top: 30px;
      border-left: 4px solid #007bff;
    }

    .automaton-explanation h4 {
      margin-bottom: 10px;
      color: #444;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .nav-tabs {
        flex-direction: column;
        border-radius: 15px;
      }
      
      .nav-tab {
        border-radius: 10px;
        margin-bottom: 5px;
      }
      
      .text-input-container {
        flex-direction: column;
      }
      
      .container {
        padding: 20px;
      }
      
      .header h1 {
        font-size: 2.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üß† Plagiarism & AI Pattern Detector</h1>
    <p>Detect text similarity and AI-generated content using Finite Automata concepts</p>
  </div>

  <!-- Navigation Bar -->
  <div class="nav-container">
    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="plagiarism">
        <i class="fas fa-search"></i>
        <span>Plagiarism Checker</span>
      </div>
      <div class="nav-tab" data-tab="ai">
        <i class="fas fa-robot"></i>
        <span>AI Content Detector</span>
      </div>
    </div>
  </div>

  <!-- Plagiarism Checker Container -->
  <div class="container active" id="plagiarism-container">
    <h2 class="container-title"><i class="fas fa-search"></i> Plagiarism Checker</h2>
    <p class="container-description">Compare two texts and visualize matching patterns using a Finite Automaton model.</p>
    
    <div class="text-input-container">
      <div class="text-input-box">
        <h3><i class="fas fa-file-alt"></i> Original Text</h3>
        <textarea id="text1" placeholder="Enter the original text here...">Machine learning is a branch of artificial intelligence that focuses on building systems that learn from data. These systems improve their performance over time without being explicitly programmed. Machine learning algorithms use statistical techniques to give computers the ability to learn with data.</textarea>
      </div>
      <div class="text-input-box">
        <h3><i class="fas fa-file-upload"></i> Submitted Text</h3>
        <textarea id="text2" placeholder="Enter the text to check for plagiarism here...">Machine learning is an area of artificial intelligence that concentrates on creating systems that learn from information. Such systems enhance their performance gradually without direct programming. Algorithms for machine learning apply statistical methods to enable computers to learn from data.</textarea>
      </div>
    </div>
    
    <div class="button-container">
      <button class="action-btn" id="checkPlagiarismBtn">
        <i class="fas fa-play-circle"></i> Check for Plagiarism
      </button>
    </div>
    
    <div id="plagiarism-result"></div>
    <div id="plagiarism-stats"></div>
    
    <h3 class="viz-title"><i class="fas fa-project-diagram"></i> Pattern Matching Automaton</h3>
    <div id="cy"></div>
    
    <div class="automaton-explanation">
      <h4><i class="fas fa-info-circle"></i> How the Automaton Works</h4>
      <p>The visualization above shows a Finite Automaton representation of the original text. Each state (circle) represents a position in the text, and transitions (arrows) represent words. The automaton processes the submitted text to identify matching patterns and calculate similarity.</p>
    </div>
  </div>

  <!-- AI Checker Container -->
  <div class="container" id="ai-container">
    <h2 class="container-title"><i class="fas fa-robot"></i> AI Content Detector</h2>
    <p class="container-description">Analyze text patterns to detect AI-generated content using automata-based linguistic analysis.</p>
    
    <div class="text-input-container">
      <div class="text-input-box">
        <h3><i class="fas fa-edit"></i> Text to Analyze</h3>
        <textarea id="ai-text" placeholder="Enter text to check for AI patterns...">The utilization of sophisticated algorithms has revolutionized data processing methodologies, thereby facilitating enhanced analytical capabilities. Consequently, organizations are leveraging these advanced computational techniques to optimize operational efficiencies and foster innovation across diverse domains. This paradigm shift underscores the transformative potential of contemporary technological advancements.</textarea>
      </div>
      <div class="text-input-box">
        <h3><i class="fas fa-cogs"></i> Analysis Parameters</h3>
        <div style="padding: 20px; background: #f8f9fa; border-radius: 10px; height: 200px; display: flex; flex-direction: column; justify-content: center;">
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Sensitivity: <span id="sensitivity-value">Medium</span></label>
            <input type="range" id="sensitivity" min="1" max="5" value="3" style="width: 100%;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Analysis Mode:</label>
            <div style="display: flex; gap: 15px;">
              <label><input type="radio" name="mode" value="fast" checked> Fast</label>
              <label><input type="radio" name="mode" value="detailed"> Detailed</label>
              <label><input type="radio" name="mode" value="comprehensive"> Comprehensive</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="button-container">
      <button class="action-btn" id="checkAIBtn">
        <i class="fas fa-brain"></i> Analyze for AI Patterns
      </button>
    </div>
    
    <div id="ai-result"></div>
    <div id="ai-stats"></div>
    
    <h3 class="viz-title"><i class="fas fa-project-diagram"></i> AI Pattern Detection Automaton</h3>
    <div id="ai-cy"></div>
    
    <div class="automaton-explanation">
      <h4><i class="fas fa-info-circle"></i> How AI Detection Works</h4>
      <p>This automaton analyzes text for patterns commonly found in AI-generated content, such as repetitive sentence structures, predictable word transitions, and specific linguistic markers. The automaton transitions between states based on linguistic features to determine the likelihood of AI authorship.</p>
    </div>
  </div>

  <div class="footer">
    <p>üß† Plagiarism & AI Pattern Detector | Built with Finite Automata Concepts | ¬© 2023</p>
  </div>

  <script>
    // Navigation between tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding container
        const tabId = tab.getAttribute('data-tab');
        document.querySelectorAll('.container').forEach(container => {
          container.classList.remove('active');
        });
        
        if (tabId === 'plagiarism') {
          document.getElementById('plagiarism-container').classList.add('active');
        } else if (tabId === 'ai') {
          document.getElementById('ai-container').classList.add('active');
        }
      });
    });

    // Sensitivity slider for AI detector
    const sensitivitySlider = document.getElementById('sensitivity');
    const sensitivityValue = document.getElementById('sensitivity-value');
    
    sensitivitySlider.addEventListener('input', () => {
      const values = ['Very Low', 'Low', 'Medium', 'High', 'Very High'];
      sensitivityValue.textContent = values[sensitivitySlider.value - 1];
    });

    // Plagiarism Checker Functionality
    document.getElementById('checkPlagiarismBtn').addEventListener('click', () => {
      const text1 = document.getElementById('text1').value.trim().toLowerCase();
      const text2 = document.getElementById('text2').value.trim().toLowerCase();

      if (!text1 || !text2) {
        alert('Please enter both texts.');
        return;
      }

      const words1 = text1.split(/\s+/);
      const words2 = text2.split(/\s+/);

      // Finite Automaton representation
      const automaton = [];
      let matched = 0;
      let consecutiveMatches = 0;
      let maxConsecutive = 0;

      for (let i = 0; i < words1.length; i++) {
        const currentState = i;
        const nextState = i + 1;
        const word = words1[i];
        automaton.push({ id: `q${currentState}`, label: `q${currentState}` });

        if (i < words1.length - 1) {
          automaton.push({
            source: `q${currentState}`,
            target: `q${nextState}`,
            word: word
          });
        }

        if (words2.includes(word)) {
          matched++;
          consecutiveMatches++;
          if (consecutiveMatches > maxConsecutive) maxConsecutive = consecutiveMatches;
        } else {
          consecutiveMatches = 0;
        }
      }

      const similarity = ((matched / words1.length) * 100).toFixed(2);
      let resultColor = '#28a745'; // Green
      if (similarity < 30) resultColor = '#dc3545'; // Red
      else if (similarity < 70) resultColor = '#ffc107'; // Yellow
      
      document.getElementById('plagiarism-result').innerHTML = `
        <div id="result">
          üîç Similarity Detected: <span style="color:${resultColor}; font-size: 1.8rem;">${similarity}%</span>
          <div style="font-size: 1rem; margin-top: 10px; color: #666;">
            ${similarity > 70 ? '‚ö†Ô∏è High similarity detected - possible plagiarism' : 
              similarity > 30 ? '‚ö†Ô∏è Moderate similarity detected' : 
              '‚úì Low similarity - likely original'}
          </div>
        </div>
      `;

      // Word match statistics
      const matchedWords = words1.filter(w => words2.includes(w));
      const unmatchedWords = words1.filter(w => !words2.includes(w));
      const uniqueMatched = [...new Set(matchedWords)];

      document.getElementById('plagiarism-stats').innerHTML = `
        <div id="stats">
          <h3 class="stats-title"><i class="fas fa-chart-bar"></i> Text Analysis Statistics</h3>
          <div class="stats-grid">
            <div class="stat-box">
              <div class="stat-title">Total Original Words</div>
              <div class="stat-value">${words1.length}</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Matched Words</div>
              <div class="stat-value">${matchedWords.length} (${((matchedWords.length/words1.length)*100).toFixed(1)}%)</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Max Consecutive Matches</div>
              <div class="stat-value">${maxConsecutive}</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Unique Matches</div>
              <div class="stat-value">${uniqueMatched.length}</div>
            </div>
          </div>
          <div style="margin-top: 20px; display: flex; gap: 30px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 300px;">
              <h4 style="margin-bottom: 10px;">Matched Words:</h4>
              <div style="background: white; padding: 15px; border-radius: 8px; max-height: 150px; overflow-y: auto;">
                ${matchedWords.length > 0 ? matchedWords.join(', ') : 'None'}
              </div>
            </div>
            <div style="flex: 1; min-width: 300px;">
              <h4 style="margin-bottom: 10px;">Unmatched Words:</h4>
              <div style="background: white; padding: 15px; border-radius: 8px; max-height: 150px; overflow-y: auto;">
                ${unmatchedWords.length > 0 ? unmatchedWords.join(', ') : 'None'}
              </div>
            </div>
          </div>
        </div>
      `;

      // --- SAFE destroy of previous Cytoscape instance ---
      try {
        const cyContainer = document.getElementById('cy');
        if (window.plagiarismCy && typeof window.plagiarismCy.destroy === 'function') {
          window.plagiarismCy.destroy();
          window.plagiarismCy = null;
        } else {
          if (cyContainer) cyContainer.innerHTML = '';
          window.plagiarismCy = null;
        }
      } catch (err) {
        const cyContainer = document.getElementById('cy');
        if (cyContainer) cyContainer.innerHTML = '';
        window.plagiarismCy = null;
      }

      // Build nodes & edges for visualization
      const nodes = [];
      const edges = [];
      for (let i = 0; i < words1.length; i++) {
        const isMatched = words2.includes(words1[i]);
        nodes.push({ 
          data: { 
            id: `q${i}`, 
            label: `q${i}`,
            matched: isMatched
          } 
        });
        
        if (i < words1.length - 1) {
          const isEdgeMatched = words2.includes(words1[i]) && words2.includes(words1[i+1]);
          edges.push({
            data: {
              id: `e${i}`,
              source: `q${i}`,
              target: `q${i + 1}`,
              label: words1[i].substring(0, 10) + (words1[i].length > 10 ? '...' : ''),
              matched: isEdgeMatched
            }
          });
        }
      }

      // Create Cytoscape graph for plagiarism
      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements: {
          nodes: nodes,
          edges: edges
        },
        style: [
          {
            selector: 'node[matched = true]',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'color': '#fff',
              'background-color': '#28a745',
              'width': 50,
              'height': 50,
              'font-size': '14px',
              'font-weight': 'bold'
            }
          },
          {
            selector: 'node[matched = false]',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'color': '#fff',
              'background-color': '#dc3545',
              'width': 50,
              'height': 50,
              'font-size': '14px'
            }
          },
          {
            selector: 'edge[matched = true]',
            style: {
              'width': 3,
              'line-color': '#28a745',
              'target-arrow-color': '#28a745',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'label': 'data(label)',
              'font-size': '11px',
              'font-weight': 'bold',
              'text-background-color': '#fff',
              'text-background-opacity': 1,
              'text-background-padding': 3
            }
          },
          {
            selector: 'edge[matched = false]',
            style: {
              'width': 2,
              'line-color': '#dc3545',
              'target-arrow-color': '#dc3545',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'label': 'data(label)',
              'font-size': '11px',
              'text-background-color': '#fff',
              'text-background-opacity': 1,
              'text-background-padding': 3
            }
          }
        ],
        layout: { 
          name: 'breadthfirst', 
          directed: true, 
          fit: true, 
          padding: 60,
          spacingFactor: 1.2
        },
        wheelSensitivity: 0.2
      });

      cy.fit();
      cy.center();
      window.plagiarismCy = cy;
    });

    // AI Checker Functionality - FIXED VERSION
    document.getElementById('checkAIBtn').addEventListener('click', () => {
      const text = document.getElementById('ai-text').value.trim();
      const sensitivity = parseInt(document.getElementById('sensitivity').value);
      const mode = document.querySelector('input[name="mode"]:checked').value;

      if (!text) {
        alert('Please enter text to analyze.');
        return;
      }

      // Calculate AI probability based on actual text content
      const aiProbability = calculateAIProbability(text, sensitivity, mode);
      
      let aiResultColor = '#28a745'; // Green (human)
      if (aiProbability > 70) aiResultColor = '#dc3545'; // Red (AI)
      else if (aiProbability > 40) aiResultColor = '#ffc107'; // Yellow (uncertain)
      
      let aiVerdict = '';
      if (aiProbability > 70) aiVerdict = 'ü§ñ Likely AI-Generated';
      else if (aiProbability > 40) aiVerdict = '‚ö†Ô∏è Possibly AI-Assisted';
      else aiVerdict = 'üë§ Likely Human-Written';
      
      document.getElementById('ai-result').innerHTML = `
        <div id="result">
          <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
            <div style="font-size: 3rem;">${aiProbability > 70 ? 'ü§ñ' : aiProbability > 40 ? '‚ö†Ô∏è' : 'üë§'}</div>
            <div>
              <div>AI Probability: <span style="color:${aiResultColor}; font-size: 2.2rem;">${aiProbability.toFixed(1)}%</span></div>
              <div style="font-size: 1.2rem; margin-top: 5px;">${aiVerdict}</div>
            </div>
          </div>
        </div>
      `;

      // Get detailed analysis for stats
      const analysis = analyzeTextForAI(text, sensitivity, mode);
      
      // Display AI analysis stats
      document.getElementById('ai-stats').innerHTML = `
        <div id="stats">
          <h3 class="stats-title"><i class="fas fa-chart-pie"></i> AI Pattern Analysis</h3>
          <div class="stats-grid">
            <div class="stat-box">
              <div class="stat-title">Word Count</div>
              <div class="stat-value">${analysis.wordCount}</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Sentence Count</div>
              <div class="stat-value">${analysis.sentenceCount}</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Avg Sentence Length</div>
              <div class="stat-value">${analysis.avgSentenceLength.toFixed(1)} words</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Formal Vocabulary Score</div>
              <div class="stat-value">${analysis.formalVocabularyScore.toFixed(1)}%</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Transition Pattern Score</div>
              <div class="stat-value">${analysis.transitionPatternScore.toFixed(1)}%</div>
            </div>
            <div class="stat-box">
              <div class="stat-title">Repetitiveness Score</div>
              <div class="stat-value">${analysis.repetitivenessScore.toFixed(1)}%</div>
            </div>
          </div>
          <div style="margin-top: 25px;">
            <h4 style="margin-bottom: 10px;">Analysis Details:</h4>
            <ul style="padding-left: 20px;">
              <li>Sensitivity setting: ${sensitivityValue.textContent}</li>
              <li>Analysis mode: ${mode.charAt(0).toUpperCase() + mode.slice(1)}</li>
              <li>${aiProbability > 70 ? 'High pattern consistency and formal vocabulary detected.' : 
                   aiProbability > 40 ? 'Moderate AI-like patterns detected.' : 
                   'Natural language patterns detected.'}</li>
              <li>Key indicators: ${analysis.topIndicators.join(', ')}</li>
            </ul>
          </div>
        </div>
      `;

      // --- SAFE destroy of previous AI Cytoscape instance ---
      try {
        const aiCyContainer = document.getElementById('ai-cy');
        if (window.aiCy && typeof window.aiCy.destroy === 'function') {
          window.aiCy.destroy();
          window.aiCy = null;
        } else {
          if (aiCyContainer) aiCyContainer.innerHTML = '';
          window.aiCy = null;
        }
      } catch (err) {
        const aiCyContainer = document.getElementById('ai-cy');
        if (aiCyContainer) aiCyContainer.innerHTML = '';
        window.aiCy = null;
      }

      // Create AI detection automaton visualization
      const aiNodes = [];
      const aiEdges = [];
      
      // Create states based on detected patterns
      const states = ['Start', 'Formal', 'Simple', 'Transition', 'Repetitive', 'End'];
      
      states.forEach((state, i) => {
        aiNodes.push({ 
          data: { 
            id: state, 
            label: state,
            aiScore: aiProbability > 70 ? 'high' : aiProbability > 40 ? 'medium' : 'low'
          } 
        });
      });
      
      // Add edges based on analysis
      aiEdges.push({ data: { id: 'e1', source: 'Start', target: 'Formal', label: 'Formal\nWord' } });
      aiEdges.push({ data: { id: 'e2', source: 'Start', target: 'Simple', label: 'Simple\nWord' } });
      aiEdges.push({ data: { id: 'e3', source: 'Formal', target: 'Transition', label: 'Transition' } });
      aiEdges.push({ data: { id: 'e4', source: 'Simple', target: 'Transition', label: 'Transition' } });
      aiEdges.push({ data: { id: 'e5', source: 'Transition', target: 'Repetitive', label: 'Repetition' } });
      aiEdges.push({ data: { id: 'e6', source: 'Transition', target: 'Formal', label: 'Formal' } });
      aiEdges.push({ data: { id: 'e7', source: 'Repetitive', target: 'End', label: 'End' } });
      aiEdges.push({ data: { id: 'e8', source: 'Transition', target: 'End', label: 'End' } });

      // Create Cytoscape graph for AI detection
      const aiCy = cytoscape({
        container: document.getElementById('ai-cy'),
        elements: {
          nodes: aiNodes,
          edges: aiEdges
        },
        style: [
          {
            selector: 'node[aiScore = "high"]',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'color': '#fff',
              'background-color': '#dc3545',
              'width': 70,
              'height': 70,
              'font-size': '14px',
              'font-weight': 'bold'
            }
          },
          {
            selector: 'node[aiScore = "medium"]',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'color': '#333',
              'background-color': '#ffc107',
              'width': 70,
              'height': 70,
              'font-size': '14px',
              'font-weight': 'bold'
            }
          },
          {
            selector: 'node[aiScore = "low"]',
            style: {
              'label': 'data(label)',
              'text-valign': 'center',
              'color': '#fff',
              'background-color': '#28a745',
              'width': 70,
              'height': 70,
              'font-size': '14px',
              'font-weight': 'bold'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 3,
              'line-color': aiProbability > 70 ? '#dc3545' : aiProbability > 40 ? '#ffc107' : '#28a745',
              'target-arrow-color': aiProbability > 70 ? '#dc3545' : aiProbability > 40 ? '#ffc107' : '#28a745',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'label': 'data(label)',
              'font-size': '11px',
              'font-weight': 'bold',
              'text-background-color': '#fff',
              'text-background-opacity': 1,
              'text-background-padding': 3,
              'text-wrap': 'wrap',
              'text-max-width': 80
            }
          }
        ],
        layout: { 
          name: 'circle',
          fit: true, 
          padding: 80,
          radius: 150
        },
        wheelSensitivity: 0.2
      });

      aiCy.fit();
      aiCy.center();
      window.aiCy = aiCy;
    });

    // FIXED: Proper AI probability calculation based on text content
    function calculateAIProbability(text, sensitivity, mode) {
      const analysis = analyzeTextForAI(text, sensitivity, mode);
      
      // Base scores from analysis
      let aiScore = 0;
      
      // Weight different factors based on sensitivity
      const sensitivityMultiplier = [0.7, 0.85, 1.0, 1.2, 1.4][sensitivity - 1];
      
      // Factor weights based on mode
      let weights = { formal: 0.3, transition: 0.25, repetitive: 0.2, structure: 0.15, buzzwords: 0.1 };
      
      if (mode === 'detailed') {
        weights = { formal: 0.25, transition: 0.3, repetitive: 0.25, structure: 0.1, buzzwords: 0.1 };
      } else if (mode === 'comprehensive') {
        weights = { formal: 0.2, transition: 0.2, repetitive: 0.2, structure: 0.2, buzzwords: 0.2 };
      }
      
      // Calculate weighted score
      aiScore += (analysis.formalVocabularyScore / 100) * weights.formal;
      aiScore += (analysis.transitionPatternScore / 100) * weights.transition;
      aiScore += (analysis.repetitivenessScore / 100) * weights.repetitive;
      aiScore += (analysis.structureScore / 100) * weights.structure;
      aiScore += (analysis.buzzwordScore / 100) * weights.buzzwords;
      
      // Apply sensitivity multiplier
      aiScore *= sensitivityMultiplier;
      
      // Convert to percentage (0-100)
      return Math.min(100, Math.max(0, aiScore * 100));
    }
    
    // FIXED: Proper text analysis for AI detection
    function analyzeTextForAI(text, sensitivity, mode) {
      const words = text.split(/\s+/);
      const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
      
      // 1. Formal vocabulary analysis
      const formalWords = ['utilization', 'methodology', 'facilitate', 'consequently', 
                          'thereby', 'paradigm', 'optimize', 'leverage', 'foster', 
                          'underscore', 'transformative', 'contemporary', 'enhanced',
                          'sophisticated', 'revolutionized', 'analytical', 'capabilities',
                          'computational', 'efficiencies', 'innovation', 'diverse', 'domains'];
      
      let formalCount = 0;
      words.forEach(word => {
        const cleanWord = word.toLowerCase().replace(/[^a-z]/g, '');
        if (formalWords.includes(cleanWord)) formalCount++;
      });
      
      const formalVocabularyScore = words.length > 0 ? (formalCount / words.length) * 100 : 0;
      
      // 2. Transition pattern analysis
      const commonTransitions = ['consequently', 'therefore', 'thus', 'hence', 'thereby',
                                'furthermore', 'moreover', 'additionally', 'however',
                                'nevertheless', 'nonetheless', 'subsequently'];
      
      let transitionCount = 0;
      sentences.forEach(sentence => {
        const sentenceWords = sentence.split(/\s+/);
        sentenceWords.forEach(word => {
          const cleanWord = word.toLowerCase().replace(/[^a-z]/g, '');
          if (commonTransitions.includes(cleanWord)) transitionCount++;
        });
      });
      
      const transitionPatternScore = sentences.length > 0 ? 
        Math.min(100, (transitionCount / sentences.length) * 50) : 0;
      
      // 3. Repetitiveness analysis
      const wordCounts = {};
      words.forEach(word => {
        const cleanWord = word.toLowerCase().replace(/[^a-z]/g, '');
        if (cleanWord && cleanWord.length > 3) {
          wordCounts[cleanWord] = (wordCounts[cleanWord] || 0) + 1;
        }
      });
      
      let repeatedWords = 0;
      Object.values(wordCounts).forEach(count => {
        if (count > 1) repeatedWords++;
      });
      
      const repetitivenessScore = Object.keys(wordCounts).length > 0 ? 
        (repeatedWords / Object.keys(wordCounts).length) * 100 : 0;
      
      // 4. Sentence structure analysis
      const avgSentenceLength = sentences.length > 0 ? 
        sentences.reduce((sum, s) => sum + s.split(/\s+/).length, 0) / sentences.length : 0;
      
      let structureScore = 0;
      if (avgSentenceLength > 25) structureScore = 80;
      else if (avgSentenceLength > 20) structureScore = 60;
      else if (avgSentenceLength > 15) structureScore = 40;
      else structureScore = 20;
      
      // 5. Buzzword analysis
      const buzzwords = ['paradigm shift', 'transformative', 'leverage', 'optimize',
                        'synergy', 'holistic', 'robust', 'seamless', 'cutting-edge',
                        'state-of-the-art', 'innovative', 'disruptive', 'scalable'];
      
      let buzzwordCount = 0;
      const textLower = text.toLowerCase();
      buzzwords.forEach(buzzword => {
        if (textLower.includes(buzzword)) buzzwordCount++;
      });
      
      const buzzwordScore = Math.min(100, buzzwordCount * 20);
      
      // 6. Determine top indicators
      const topIndicators = [];
      if (formalVocabularyScore > 30) topIndicators.push('Formal Vocabulary');
      if (transitionPatternScore > 40) topIndicators.push('Predictable Transitions');
      if (repetitivenessScore > 30) topIndicators.push('Word Repetition');
      if (structureScore > 60) topIndicators.push('Uniform Sentence Length');
      if (buzzwordScore > 40) topIndicators.push('Buzzword Usage');
      
      if (topIndicators.length === 0) topIndicators.push('Natural Language Patterns');
      
      return {
        wordCount: words.length,
        sentenceCount: sentences.length,
        avgSentenceLength: avgSentenceLength,
        formalVocabularyScore: formalVocabularyScore,
        transitionPatternScore: transitionPatternScore,
        repetitivenessScore: repetitivenessScore,
        structureScore: structureScore,
        buzzwordScore: buzzwordScore,
        topIndicators: topIndicators
      };
    }

    // Initialize with example data
    document.getElementById('checkPlagiarismBtn').click();
  </script>
</body>
</html>